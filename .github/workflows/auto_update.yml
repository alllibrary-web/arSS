import os
import requests
from github import Github

# 1. Получаем токен из GitHub Actions (секрет GH_TOKEN)
token = os.getenv("GITHUB_TOKEN")
if not token:
    raise Exception("❌ Ошибка: переменная окружения GITHUB_TOKEN не найдена!")

# 2. Подключаемся к GitHub через PyGithub
g = Github(token)

# 3. Открываем репозиторий (замени на свой!)
repo = g.get_repo("alllibrary-web/arSS")   # <-- ВАЖНО! Укажи свой путь, например: ArtyomSvesh/AutoTorrent

# 4. Загружаем файл torrents.txt (или любой другой файл)
file_path = "torrents.txt"
contents = repo.get_contents(file_path)

# 5. Делаем запрос к твоему источнику
url = "https://site.com/torrents-list"  # замени на настоящий URL!
data = requests.get(url).text

# 6. Обновляем файл в GitHub
repo.update_file(
    contents.path,
    "Auto update torrents",
    data,
    contents.sha
)

print("✔ Файл обновлён успешно!")
